version: 0.1

phases:
  pre_build:
    commands:
      - echo Logging in to Amazon ECR...
      - aws ecr get-login --no-include-email --region $AWS_DEFAULT_REGION
      - docker login -u AWS -p eyJwYXlsb2FkIjoiWUF3MXdTYllBbTUwd2hVSjNudlJ5RWFmb1RiaXp0QmFoSlNUTmEyNG1taUJROWdpVHA0VWdxVFEvOTZIYlRmb2x5ejZHTjIyK3VVaSsxWXlvd0Y0enRKa1VKK29SL3k0TkcyMUVZZE96eElRNVlnaGp2c3JNdjBJTTFWVHVud090Y3hBQmg1RkJzVERiVytsY1duaHRoWkZOM3RKNFoydjZOMmNTWDZOVHFDcVU2R0t4QTVTaFFqL1JyS2VobUJ6ZHNxREhndTFKVm5vajlkRmk5VEhpZkhId1IyLzN4Wm5DWWtlalM3SVQzNnJudGpaa04zK3FQTTJlcHRnVUpUQWtYdmFBMW5tYnRrOS84KzVKK0JpZFhlK0dFTU9XTThVQWpDUEQxeWZDMlRUbEZHZ2VTWGxtWlJLZTJaNUxpTEQrLzNYY3hEMU1uOCsvRXYyZEtyYnUzT1hnOGppYzl3Z2F4aW9JbTE1V255SEpJR3hCc3l0UFREQTNNRFl2WkE5dlhJWmEvcVA1M2hydUxhV2ZZeUFEelorTTNWU2V6YXd0TU9zMWVEeDJnUjJDc2JjWDBFQnVDbG1yVnR5SlRpUnJFMTFycFBlTnFDMG1nTUI5Vk02anNzT3FPajNOZ0dXQW1pM082V0gxNi9QSndPcE5qT3JPYjJoMHRGT0JiVzRTRHlFd0xhRCs4RjJXdEVuZDJWOXc1cEVOaEpJUERVRlpJY1dJUHNydEhYNWJqL3h3QVhVOG1PdjFhVTVVRjc1VUliR3J0czFIZkpINHpUWHJhMThKV3NYVUlaYzBVUmVVUDRYM0hSdTRVMVIvVGg2b0huZ01sOElBQjdNaXNMcnVaRDhWdGZKL1F3Y05RMUE0Vi9RK2lJenJweHpHVDI2aG92Ny84OUR4WEw0aUZRbURwSmR5K1pGbzB2V1dhTUhSRkRGbGRLZEJsTE1TckZuWFJkUHY3WldrdlAwNjR2aXd5djhUNDlQRklPRy9oQlRpdVB5OXMrQ016ME11UnhGZXlqTzdBU1FnbTBvbm1DK2N2ZzZMQ2NIdmlBZWZDamhPRzZaU042KzNWT09aZFdNUGpzL0NwSXUyZXltb1NiY0VIZk9ZTEh3MzJ2R21CSzI1RGtucG5QY1QyNDBVQnRLN0pVMzN3dVowVEpCN3ZncldDM0xwWlhZY3lrczhjK21md2hHaS9TZEF5eW8vL3BqN0o1RUF5bkhhQVo5OHhWL3lhSm4vYU9tbTJ5WmI2ZVNkeDVla3JjNVZLR1J6SXppLzhvUGdDNnNKTDZ3S0JZd2tONEFQQmJQdGpjWGFRNVIrRkpMd0ZxSkovTndQaXY3YTZHUkZEY3VheC9kTTNSc2YySkljakhrQmV3eHkvUkFmeXI0SWZRQlowUEdvUk5QdStmUzF1RTdKbHY3enN4ZCtCSmszUnBhYmtiL3hidjdURjdRdERFSU9XWTkzOTdPZ00zb1pWeFFzMDg0QVFpemR5bzNHSVlZR0xUQ3lJNHQveUtiWWJ0ME1UTzdmNStiNTNHY2pMekxXc2VCZ2RIaEpEMHVaWXQxbmtpSzl4aXBSSThyTTRNcENMWVFvMENmVlo2MEFiSmZuSStZMHJJMEVSbUk5OXN3SWNYU0s1NDhaYmV0bW1zR1I4NGJPVGZWQ3MvMTNoUFdyakZvbGx4dGxwTElmdDNwanlMKzBIaU9KNDdocU1lTFNjMnp1TXlwOS9OaGN5MFZaWUdLdjhROUNvZHdVYXVoOUI3andNaElUVGU2VkxGaTNsRDZyWjhZQWFRa3dDTFQ5bGVqMjh4QktXQlVqYi9GTGZLR2xIM0NyTXdSL0FmaU94YVZqZ0J5cGtGVXRrN1AwRDJHRFRaWUhBcUxOUWpndWd5LzhSNWQ4NEdyVXhNa25EUk1PQmx2d2JNb1BIamZGZVByNVZoOEZjUWx3aytMQXBVbEc1Q2lIa09ma3RsM0wwaGtxZ0sxcVBDUnUvNm52dzFVRXVwM2Vab0RMNDBoWXJhN3BDZkNWTjkrYk9FajZ6bVlmemxZc2JDdzJwTzdxUXBqQytodTRwbkV4NmpEWU92R3pmYTZvWVg0ZFp1ZmtKSXV0VGRGNkloVnR5QmN2NVdXRC9FOVNVcnl0eUUxbUN2Q3ZNK2QzVWR3ZEJWTlVWV29uczdqdkE4M00rVWtFTzZpVEdlMExERT0iLCJkYXRha2V5IjoiQVFFQkFIaHdtMFlhSVNKZVJ0Sm01bjFHNnVxZWVrWHVvWFhQZTVVRmNlOVJxOC8xNHdBQUFINHdmQVlKS29aSWh2Y05BUWNHb0c4d2JRSUJBREJvQmdrcWhraUc5dzBCQndFd0hnWUpZSVpJQVdVREJBRXVNQkVFREd3SDFsQnpuMzlSR1ArU2tnSUJFSUE3UFpDRFJaRnBuY0pDNkJaekZrbFBXWGsrYmZGeUVwMnBONEd4MGFZem5oSjlYVGx5R2JibEgrZXZabS9Oa0lDNXNGaWZZdXd5cWY3czlZWT0iLCJ2ZXJzaW9uIjoiMiIsInR5cGUiOiJEQVRBX0tFWSIsImV4cGlyYXRpb24iOjE1Njk0MzY1NTV9 https://500735694507.dkr.ecr.us-east-1.amazonaws.com
  build:
    commands:
      - echo Build started on `date`
      - echo Building the Docker image...          
      - docker build -t $IMAGE_REPO_NAME .
      - docker tag $IMAGE_REPO_NAME:$IMAGE_TAG $AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/$IMAGE_REPO_NAME:$IMAGE_TAG 
  post_build:
    commands:
      - echo Build completed on `date`
      - echo Pushing the Docker image...
      - docker push $AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/$IMAGE_REPO_NAME:$IMAGE_TAG  
      - echo renaming _Dockerrun.aws.json file
      - mv _Dockerrun.aws.json Dockerrun.aws.json
      - echo deleting Dockerfile
      - rm Dockerfile
artifacts:
  files:
    - '**/*'
